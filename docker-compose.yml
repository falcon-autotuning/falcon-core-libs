
services:
  dev:
    image: archlinux:latest
    container_name: falcon-arch-dev
    tty: true
    stdin_open: true
    environment:
      # Forward SSH agent for git operations inside the container.
      - SSH_AUTH_SOCK=/ssh-agent
      # Pass GitHub token for downloading private release assets.
      - GH_TOKEN=${GH_TOKEN}
    volumes:
      # Mount your project directory into /workdir.
      - .:/workdir:rw,z
      # Persist ccache across container restarts to speed up builds.
      - falcon-arch-ccache:/home/daniel/.ccache
      # Mount the SSH agent socket.
      - ${SSH_AUTH_SOCK}:/ssh-agent:z
      # Mount your SSH keys for read-only access.
      - ~/.ssh:/home/daniel/.ssh:ro,z
      # Mount the entrypoint script.
      - ./docker-entrypoint.sh:/docker-entrypoint.sh:ro,z
    working_dir: /workdir
    # The entrypoint runs our setup script as root.
    entrypoint: ["/bin/bash", "/docker-entrypoint.sh"]

volumes:
  falcon-arch-ccache:
